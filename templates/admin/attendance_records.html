{% extends "base.html" %}

{% block title %}Attendance Records{% endblock %}
{% block page_title %}Attendance Records{% endblock %}

{% block content %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/attendance_records.css') }}">

    <div class="container">
        <h3>Attendance Records</h3>

        <!-- Unified Month Selection with Filter and Export Buttons -->
        <div class="filter-export-wrapper">
            <label for="month">Select Month:</label>
            <input type="month" id="month" name="month" value="{{ request.args.get('month', current_month) }}" class="filter-input">
            
            <button type="submit" form="filter-form" class="btn filter-btn">Filter</button>

            <form method="GET" action="{{ url_for('admin.export_pdf') }}" target="_blank" class="export-form">
                <input type="hidden" name="month" id="export-month">
                <button type="submit" class="btn export-btn">Print</button>
            </form>
        </div>

        <!-- Hidden Form for Filtering (Now Uses GET) -->
        <form id="filter-form" method="GET" action="{{ url_for('admin.admin_attendance') }}" style="display: none;">
            <input type="hidden" name="month" id="filter-month">
        </form>

        <script>
            // Update both hidden inputs when the user selects a month
            document.getElementById('month').addEventListener('change', function() {
                document.getElementById('filter-month').value = this.value;
                document.getElementById('export-month').value = this.value;
            });
        </script>

        <!-- Attendance Table -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Date</th>
                        <th>Clock In</th>
                        <th>Clock Out</th>
                        <th>Total Hours</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in attendance %}
                    <tr>
                        <td>{{ record.username }}</td>
                        <td>{{ record.clock_in.strftime('%Y-%m-%d')}}</td>
                        <td>{{ record.clock_in.strftime('%I:%M %p') }}</td>
                        <td>
                            {{ record.clock_out.strftime('%I:%M %p') if record.clock_out else 'N/A' }}
                        </td>
                        <td>
                            {% if record.clock_in and record.clock_out %}
                                {{ ((record.clock_out - record.clock_in).seconds // 3600)|int }}h
                                {{ ((record.clock_out - record.clock_in).seconds % 3600) // 60 }}m
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('admin.view_user_logs', employee_id=record.employee_id) }}" class="edit-btn">Review</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Export Section -->
        <div class="export-section">
            
        </div>

{% endblock %}
